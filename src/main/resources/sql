 
CREATE SCHEMA `AuthControl` ;

CREATE TABLE `AuthControl`.`Project` (
  `projectID` VARCHAR(20) NOT NULL,
  `projectName` VARCHAR(45) NOT NULL,
  `creator` INT NOT NULL,
  `status` VARCHAR(10) NOT NULL,
  `createDate` DATE NOT NULL,
  `finishDate` DATE NULL,
  `path` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`projectID`),
  UNIQUE INDEX `ProjectID_UNIQUE` (`projectID` ASC) VISIBLE,
  UNIQUE INDEX `ProjectName_UNIQUE` (`projectName` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`SubTask` (
  `taskID` VARCHAR(20) NOT NULL,
  `taskType` CHAR(1) NOT NULL,
  `status` VARCHAR(10) NOT NULL,
  `excutor` INT NOT NULL,
  `projectID` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`taskID`),
  UNIQUE INDEX `taskID_UNIQUE` (`taskID` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`Authorize` (
  `authorizeID` INT NOT NULL AUTO_INCREMENT,
  `projectID` VARCHAR(20) NOT NULL,
  `adminID` INT NOT NULL,
  `authorizeDate` DATE NOT NULL,
  `operator` VARCHAR(5) NOT NULL,
  PRIMARY KEY (`authorizeID`),
  UNIQUE INDEX `AuthoeizeID_UNIQUE` (`authorizeID` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`Entrust` (
  `entrustID` INT NOT NULL AUTO_INCREMENT,
  `status` VARCHAR(10) NOT NULL,
  `entrustStartDate` DATE NOT NULL,
  `entrustEndDate` DATE NOT NULL,
  `subTask` VARCHAR(20) NOT NULL,
  `entrustWorker` INT NOT NULL,
  PRIMARY KEY (`entrustID`),
  UNIQUE INDEX `entrustID_UNIQUE` (`entrustID` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`Notice` (
  `noticeID` INT NOT NULL AUTO_INCREMENT,
  `message` VARCHAR(100) NOT NULL,
  `workerID` INT NOT NULL,
  `noticeDate` DATETIME NOT NULL,
  PRIMARY KEY (`noticeID`),
  UNIQUE INDEX `noticeID_UNIQUE` (`noticeID` ASC) VISIBLE);

  ALTER TABLE `AuthControl`.`Entrust` 
CHANGE COLUMN `entrustStartDate` `entrustStartDate` DATETIME NOT NULL ;

ALTER TABLE `AuthControl`.`Authorize` 
CHANGE COLUMN `authorizeDate` `authorizeDate` DATETIME NOT NULL ;

ALTER TABLE `AuthControl`.`Project` 
CHANGE COLUMN `createDate` `createDate` DATETIME NOT NULL ,
CHANGE COLUMN `finishDate` `finishDate` DATETIME NULL DEFAULT NULL ;

ALTER TABLE `AuthControl`.`Entrust` 
CHANGE COLUMN `entrustEndDate` `entrustEndDate` DATETIME NOT NULL ;

  CREATE TABLE `AuthControl`.`Role` (
  `roleID` INT NOT NULL AUTO_INCREMENT,
  `roleName` VARCHAR(20) NOT NULL,
  `permissonName` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`roleID`),
  UNIQUE INDEX `roleID_UNIQUE` (`roleID` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`user` (
  `userID` INT NOT NULL,
  `userName` VARCHAR(45) NOT NULL,
  `userPwd` VARCHAR(45) NOT NULL,
  `roleID` INT NOT NULL,
  `token` VARCHAR(45) NULL,
  `isDelete` TINYINT NOT NULL DEFAULT 0,
  PRIMARY KEY (`userID`),
  UNIQUE INDEX `userID_UNIQUE` (`userID` ASC) VISIBLE);

  ALTER TABLE `AuthControl`.`Notice` 
CHANGE COLUMN `workerID` `receiver` INT NOT NULL ;

ALTER TABLE `AuthControl`.`Notice` 
ADD COLUMN `isRead` TINYINT NOT NULL DEFAULT 0 AFTER `noticeDate`;

ALTER TABLE `AuthControl`.`Role` 
DROP COLUMN `permissonName`;

CREATE TABLE `AuthControl`.`Permission` (
  `permissionID` INT NOT NULL AUTO_INCREMENT,
  `permissionName` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`permissionID`),
  UNIQUE INDEX `permissionID_UNIQUE` (`permissionID` ASC) VISIBLE,
  UNIQUE INDEX `permissionName_UNIQUE` (`permissionName` ASC) VISIBLE);

  CREATE TABLE `AuthControl`.`PermissionRole` (
  `RoleID` VARCHAR(45) NOT NULL,
  `PermissionID` INT NOT NULL,
  `ID` INT NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`ID`),
  UNIQUE INDEX `ID_UNIQUE` (`ID` ASC) VISIBLE);

  ALTER TABLE `AuthControl`.`Authorize` 
ADD CONSTRAINT `fk_Authorize_1`
  FOREIGN KEY (`adminID`)
  REFERENCES `AuthControl`.`user` (`userID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

  ALTER TABLE `AuthControl`.`Project` 
ADD INDEX `Creator_idx` (`creator` ASC) VISIBLE;
;
ALTER TABLE `AuthControl`.`Project` 
ADD CONSTRAINT `Creator`
  FOREIGN KEY (`creator`)
  REFERENCES `AuthControl`.`user` (`userID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

  ALTER TABLE `AuthControl`.`Role` 
RENAME TO  `AuthControl`.`RoleD` ;

ALTER TABLE `AuthControl`.`PermissionRole` 
CHANGE COLUMN `RoleID` `RoleID` INT NOT NULL ;

ALTER TABLE `AuthControl`.`PermissionRole` 
ADD INDEX `fk_PermissionRole_2_idx1` (`RoleID` ASC) VISIBLE;
;
ALTER TABLE `AuthControl`.`PermissionRole` 
ADD CONSTRAINT `fk_PermissionRole_1`
  FOREIGN KEY (`PermissionID`)
  REFERENCES `AuthControl`.`Permission` (`permissionID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `fk_PermissionRole_2`
  FOREIGN KEY (`RoleID`)
  REFERENCES `AuthControl`.`RoleD` (`roleID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

  ALTER TABLE `AuthControl`.`Entrust` 
ADD INDEX `fk_Entrust_1_idx` (`entrustWorker` ASC) VISIBLE;
;
ALTER TABLE `AuthControl`.`Entrust` 
ADD CONSTRAINT `fk_Entrust_1`
  FOREIGN KEY (`entrustWorker`)
  REFERENCES `AuthControl`.`user` (`userID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

  ALTER TABLE `AuthControl`.`user` 
ADD INDEX `fk_user_1_idx` (`roleID` ASC) VISIBLE;
;
ALTER TABLE `AuthControl`.`user` 
ADD CONSTRAINT `fk_user_1`
  FOREIGN KEY (`roleID`)
  REFERENCES `AuthControl`.`RoleD` (`roleID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

  ALTER TABLE `AuthControl`.`user` 
RENAME TO  `AuthControl`.`User` ;

ALTER TABLE `AuthControl`.`Permission` 
ADD COLUMN `permissionTarget` VARCHAR(20) NOT NULL AFTER `permissionName`,
DROP INDEX `permissionName_UNIQUE` ;
;

INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('read', 'project');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('start', 'project');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('end', 'project');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('restart', 'project');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('create', 'project');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('read', 'user');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('add', 'user');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('delete', 'user');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('changePosition', 'user');
INSERT INTO `AuthControl`.`Permission` (`permissionName`, `permissionTarget`) VALUES ('changePwd', 'user');


INSERT INTO `AuthControl`.`RoleD` (`roleName`) VALUES ('ROLE_WORKERA');
INSERT INTO `AuthControl`.`RoleD` (`roleName`) VALUES ('ROLE_WORKERB');
INSERT INTO `AuthControl`.`RoleD` (`roleName`) VALUES ('ROLE_WORKERC');
INSERT INTO `AuthControl`.`RoleD` (`roleName`) VALUES ('ROLE_ADMIN');
INSERT INTO `AuthControl`.`RoleD` (`roleName`) VALUES ('ROLE_SUPERADMIN');

INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('1', '1');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('1', '6');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('1', '10');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('2', '1');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('2', '6');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('2', '10');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('3', '1');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('3', '6');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('3', '10');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '1');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '2');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '3');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '4');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '5');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '6');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('4', '10');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '6');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '7');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '8');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '9');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '10');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '1');

ALTER TABLE `AuthControl`.`SubTask` 
CHANGE COLUMN `excutor` `excutor` VARCHAR(15) NOT NULL ;

ALTER TABLE `AuthControl`.`Project` 
DROP FOREIGN KEY `Creator`;
ALTER TABLE `AuthControl`.`Project` 
DROP INDEX `Creator_idx` ;
;

ALTER TABLE `AuthControl`.`Notice` 
CHANGE COLUMN `receiver` `receiver` VARCHAR(15) NOT NULL ;

ALTER TABLE `AuthControl`.`Authorize` 
DROP FOREIGN KEY `fk_Authorize_1`;
ALTER TABLE `AuthControl`.`Authorize` 
CHANGE COLUMN `adminID` `adminID` VARCHAR(15) NOT NULL ,
DROP INDEX `Project_idx` ;
;

ALTER TABLE `AuthControl`.`Entrust` 
DROP FOREIGN KEY `fk_Entrust_1`;
ALTER TABLE `AuthControl`.`Entrust` 
CHANGE COLUMN `entrustWorker` `entrustWorker` VARCHAR(15) NOT NULL ,
DROP INDEX `fk_Entrust_1_idx` ;
;

ALTER TABLE `AuthControl`.`User` 
CHANGE COLUMN `userID` `userID` VARCHAR(15) NOT NULL ;

INSERT INTO `AuthControl`.`User` (`userID`, `userName`, `userPwd`, `roleID`, `token`, `isDelete`) VALUES ('551801', 'kaito', 'kaito', '1', '123456', '0');

ALTER TABLE `AuthControl`.`Authorize` 
RENAME TO  `AuthControl`.`authorize` ;

ALTER TABLE `AuthControl`.`User` 
RENAME TO  `AuthControl`.`user` ;

CREATE TABLE `AuthControl`.`constants` (
  `workerID` VARCHAR(15) NOT NULL,
  `adminID` VARCHAR(15) NOT NULL,
  `superID` VARCHAR(15) NOT NULL);

  ALTER TABLE `AuthControl`.`constants` 
ADD COLUMN `ID` INT NOT NULL AFTER `superID`,
ADD PRIMARY KEY (`ID`);
;

INSERT INTO `AuthControl`.`constants` (`workerID`, `adminID`, `superID`, `ID`) VALUES ('551801', '880000', '999900', '1');

ALTER TABLE `AuthControl`.`Project` 
CHANGE COLUMN `creator` `creator` VARCHAR(15) NOT NULL ;

ALTER TABLE `AuthControl`.`SubTask` 
ADD COLUMN `index` INT NOT NULL AFTER `projectID`;
ALTER TABLE `AuthControl`.`SubTask`
CHANGE COLUMN `excutor` `executor` VARCHAR(15) NOT NULL ;

CREATE TABLE `AuthControl`.`operation` (
  `operationID` INT NOT NULL AUTO_INCREMENT,
  `operatorID` VARCHAR(15) NOT NULL,
  `time` DATETIME NOT NULL,
  PRIMARY KEY (`operationID`),
  UNIQUE INDEX `operationID_UNIQUE` (`operationID` ASC) VISIBLE);

INSERT INTO `AuthControl`.`Permission` (`permissionID`, `permissionName`, `permissionTarget`) VALUES ('11', 'add', 'role');
INSERT INTO `AuthControl`.`Permission` (`permissionID`, `permissionName`, `permissionTarget`) VALUES ('12', 'edit', 'role');

INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '11');
INSERT INTO `AuthControl`.`PermissionRole` (`RoleID`, `PermissionID`) VALUES ('5', '12');


ALTER TABLE `AuthControl`.`PermissionRole`
DROP FOREIGN KEY `fk_PermissionRole_2`;
ALTER TABLE `AuthControl`.`PermissionRole`
CHANGE COLUMN `RoleID` `roleID` INT NOT NULL ;
ALTER TABLE `AuthControl`.`PermissionRole`
ADD CONSTRAINT `fk_PermissionRole_2`
  FOREIGN KEY (`roleID`)
  REFERENCES `AuthControl`.`RoleD` (`roleID`);


INSERT INTO `AuthControl`.`Permission` (`permissionID`, `permissionName`, `permissionTarget`) VALUES ('13', 'add', 'permission');
INSERT INTO `AuthControl`.`Permission` (`permissionID`, `permissionName`, `permissionTarget`) VALUES ('14', 'edit', 'permission');

INSERT INTO `AuthControl`.`PermissionRole` (`roleID`, `PermissionID`) VALUES ('5', '13');
INSERT INTO `AuthControl`.`PermissionRole` (`roleID`, `PermissionID`) VALUES ('5', '14');
